This is a graph problem. Model it and then solve it using either dfs or union find.